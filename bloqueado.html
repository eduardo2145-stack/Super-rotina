<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assinatura Pendente - Amigo Virtual</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #f4f7f6;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .card-bloqueio {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            text-align: center;
            max-width: 400px;
            width: 100%;
            border-top: 5px solid #e74c3c;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .icone-cadeado {
            font-size: 50px;
            margin-bottom: 15px;
            display: inline-block;
            background: #fdf2f2;
            padding: 20px;
            border-radius: 50%;
        }

        h1 {
            color: #2c3e50;
            font-size: 22px;
            margin-top: 0;
            margin-bottom: 10px;
        }

        p {
            color: #7f8c8d;
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .box-preco {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .box-preco span {
            display: block;
            color: #64748b;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        #valorAssinatura {
            font-size: 32px;
            font-weight: 800;
            color: #0f172a;
            margin: 0;
        }

        .btn-assinar {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .btn-assinar:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .btn-assinar:disabled {
            background: #bdc3c7;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

      .btn-voltar {
            background: #f1f5f9; /* Cinza clarinho chique */
            color: #475569; /* Texto cinza escuro */
            border: none;
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Espa√ßo pro √≠cone */
            width: 100%;
        }

        .btn-voltar:hover {
            background: #e2e8f0; /* Fica um pouco mais escuro ao passar o mouse */
            color: #1e293b;
        }
        
        /* Ajuste pro SVG do bot√£o */
        .btn-voltar svg {
            transition: transform 0.2s;
        }
        
        .btn-voltar:hover svg {
            transform: translateX(-4px); /* Setinha d√° um pulo pra esquerda */
        }
    </style>
</head>
<body>

    <div class="card-bloqueio">
        <div class="icone-cadeado">üîí</div>
        <h1>Acesso Bloqueado</h1>
        <p>Sua assinatura do Amigo Virtual est√° inativa ou pendente. Para liberar o acesso instant√¢neo ao painel, regularize o seu plano.</p>
        
        <div class="box-preco">
            <span>Valor do Plano</span>
            <div id="valorAssinatura">Carregando...</div>
        </div>

        <button id="btnAssinar" class="btn-assinar" disabled>‚è≥ Buscando link seguro...</button>
        
        <br>
   <button class="btn-voltar" onclick="sairParaLogin()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            Sair e Voltar ao Login
        </button>
     </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
         apiKey: "AIzaSyAh3J8bp7xvNGct8k4TfAoCcIpVRoWjBYI", 
         authDomain: "rotinaeduardo.firebaseapp.com", 
         projectId: "rotinaeduardo", 
         storageBucket: "rotinaeduardo.firebasestorage.app",
          messagingSenderId: "210945268922", 
          appId: "1:210945268922:web:ce9e585872090b378d7683", 
          measurementId: "G-MDYWRH9RNP" };
        const app = initializeApp(firebaseConfig); 
        const db = getFirestore(app); 
        const auth = getAuth(app);
       
        // Fun√ß√£o que vai l√° no painel Admin ler as configura√ß√µes do dono
        async function carregarDadosPagamento() {
            try {
                const configRef = doc(db, "configuracoes", "pagamento");
                const docSnap = await getDoc(configRef);

                const btn = document.getElementById('btnAssinar');
                const valorDisplay = document.getElementById('valorAssinatura');

                if (docSnap.exists()) {
                    const dados = docSnap.data();
                    const valor = dados.valor_mensal || 0;
                    const link = dados.link_checkout || "";

                    // Coloca o valor na tela formato R$
                    valorDisplay.innerText = valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                    // Configura o bot√£o
                    if (link.length > 5) {
                        btn.innerText = "üí≥ Pagar e Liberar Acesso";
                        btn.disabled = false;
                        btn.onclick = () => window.open(link, '_blank'); // Abre o link de pagamento em outra aba
                    } else {
                        btn.innerText = "Link indispon√≠vel no momento";
                    }
                } else {
                    valorDisplay.innerText = "R$ 0,00";
                    btn.innerText = "Configura√ß√£o n√£o encontrada";
                }
            } catch (erro) {
                console.error("Erro ao buscar pagamento:", erro);
                document.getElementById('valorAssinatura').innerText = "Erro";
                document.getElementById('btnAssinar').innerText = "Erro na conex√£o";
            }
        }

        // Inicia a busca assim que a p√°gina abre
        carregarDadosPagamento();

        // Fun√ß√£o do bot√£o de voltar inteligente
        window.sairParaLogin = function() {
            signOut(auth).then(() => {
                const ehMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                if (ehMobile || window.innerWidth <= 768) {
                    window.location.replace("mobile.html"); 
                } else {
                    window.location.replace("painel.html"); 
                }
            });
        };
    </script>
</body>
</html>