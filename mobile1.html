<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rotina Eduardo - Mobile</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#eef2f7;
}

/* Telas */
.tela{
    display:none;
    padding:20px;
}
.tela.active{
    display:block;
}

/* Card */
.card{
    background:white;
    padding:20px;
    border-radius:16px;
    box-shadow:0 5px 20px rgba(0,0,0,0.08);
    margin-bottom:20px;
}

/* Inputs */
input, button{
    width:100%;
    padding:12px;
    margin-top:10px;
    border-radius:12px;
    border:1px solid #ccc;
    font-size:16px;
}

button{
    background:#3498db;
    color:white;
    border:none;
}

/* Menu inferior */
.menu{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:white;
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    border-top:1px solid #ddd;
}
.menu button{
    background:none;
    border:none;
    font-size:14px;
    color:#555;
}
.menu button.active{
    color:#3498db;
    font-weight:bold;
}

#dashboard{
    padding-bottom:80px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="tela active">
    <div class="card">
        <h2>Entrar</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="senha" placeholder="Senha">
        <button onclick="login()">Entrar</button>
        <button onclick="mostrarCadastro()">Criar Conta</button>
    </div>
</div>

<!-- CADASTRO -->
<div id="cadastro" class="tela">
    <div class="card">
        <h2>Criar Conta</h2>
        <input type="email" id="emailCad" placeholder="Email">
        <input type="password" id="senhaCad" placeholder="Senha">
        <button onclick="criarConta()">Cadastrar</button>
        <button onclick="voltarLogin()">Voltar</button>
    </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="tela">

    <div id="sec-atividades" class="secao active">
        <div class="card">
            <h3>Nova Atividade</h3>
            <input type="text" id="atividade" placeholder="Digite atividade">
            <button onclick="salvarAtividade()">Salvar</button>
        </div>

        <div class="card">
            <h3>Minhas Atividades</h3>
            <div id="lista"></div>
        </div>
    </div>

    <div id="sec-monitor" class="secao" style="display:none;">
        <div class="card">
            <h3>Monitor</h3>
            <p>Em desenvolvimento</p>
        </div>
    </div>

    <div class="menu">
        <button class="active" onclick="abrirSecao('atividades', this)">Atividades</button>
        <button onclick="abrirSecao('monitor', this)">Monitor</button>
        <button onclick="logout()">Sair</button>
    </div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyAh3J8bp7xvNGct8k4TfAoCcIpVRoWjBYI",
authDomain: "rotinaeduardo.firebaseapp.com",
projectId: "rotinaeduardo",
storageBucket: "rotinaeduardo.firebasestorage.app",
messagingSenderId: "210945268922",
appId: "1:210945268922:web:ce9e585872090b378d7683"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* Telas */
function mostrar(id){
    document.querySelectorAll('.tela').forEach(t=>t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

window.mostrarCadastro = ()=> mostrar("cadastro");
window.voltarLogin = ()=> mostrar("login");

/* Auth */
window.criarConta = async ()=>{
    const email = document.getElementById("emailCad").value;
    const senha = document.getElementById("senhaCad").value;
    await createUserWithEmailAndPassword(auth,email,senha);
};

window.login = async ()=>{
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    await signInWithEmailAndPassword(auth,email,senha);
};

window.logout = ()=> signOut(auth);

onAuthStateChanged(auth,user=>{
    if(user){
        mostrar("dashboard");
        carregarAtividades();
    }else{
        mostrar("login");
    }
});

/* Firestore */
async function salvarAtividade(){
    const texto = document.getElementById("atividade").value;
    if(!texto) return;
    await addDoc(collection(db,"atividades"),{
        texto:texto,
        uid:auth.currentUser.uid,
        criado:Date.now()
    });
    document.getElementById("atividade").value="";
}
window.salvarAtividade = salvarAtividade;

function carregarAtividades(){
    const lista = document.getElementById("lista");
    onSnapshot(collection(db,"atividades"),snapshot=>{
        lista.innerHTML="";
        snapshot.forEach(doc=>{
            const d = doc.data();
            if(d.uid===auth.currentUser.uid){
                lista.innerHTML+=`<p>â€¢ ${d.texto}</p>`;
            }
        });
    });
}

/* Menu */
window.abrirSecao = (sec,btn)=>{
    document.getElementById("sec-atividades").style.display="none";
    document.getElementById("sec-monitor").style.display="none";
    document.getElementById("sec-"+sec).style.display="block";

    document.querySelectorAll(".menu button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
};

</script>

</body>
</html>
