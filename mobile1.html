<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Rotina</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #f1f3f6;
}

.app-container {
    max-width: 480px;
    margin: auto;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: #f1f3f6;
}

.app-header {
    background: #3498db;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 18px;
    position: sticky;
    top: 0;
}

.btn-logout {
    position: absolute;
    right: 15px;
    top: 15px;
    background: transparent;
    border: none;
    color: white;
}

main {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
}

.card {
    background: white;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.screen { display: none; }
.screen.active { display: block; }

.bottom-nav {
    display: flex;
    justify-content: space-around;
    background: white;
    padding: 10px 0;
    border-top: 1px solid #ddd;
}

.nav-item {
    background: none;
    border: none;
    font-size: 20px;
    color: #888;
}

.nav-item.active { color: #3498db; }

input, select {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 12px;
    border: 1px solid #ddd;
}

.btn-primary {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    background: #3498db;
    color: white;
    border: none;
    font-weight: bold;
}

ul { padding-left: 15px; }
</style>
</head>

<body>

<div class="app-container">

<header class="app-header">
    Super Rotina
    <button onclick="logout()" class="btn-logout">Sair</button>
</header>

<main>

<section id="screen-dashboard" class="screen active">
    <div class="card">
        <h3>üñ•Ô∏è Monitoramento</h3>
        <div id="painelMonitoramento">Bem-vindo!</div>
    </div>
</section>

<section id="screen-atividades" class="screen">
    <div class="card">
        <h3>üé® Nova Atividade</h3>

        <input type="text" id="txtAtividade" placeholder="Texto da atividade">
        <button class="btn-primary" onclick="salvarAtividade()">Salvar</button>
    </div>

    <div class="card">
        <h3>Lista</h3>
        <ul id="listaAtividades"></ul>
    </div>
</section>

<section id="screen-rotinas" class="screen">
    <div class="card">
        <h3>üìÖ Nova Rotina</h3>

        <input type="time" id="horaRotina">
        <button class="btn-primary" onclick="salvarRotina()">Salvar</button>
    </div>

    <div class="card">
        <h3>Rotinas</h3>
        <div id="listaRotinas"></div>
    </div>
</section>

</main>

<nav class="bottom-nav">
    <button onclick="trocarTela('dashboard', this)" class="nav-item active">üè†</button>
    <button onclick="trocarTela('atividades', this)" class="nav-item">üéØ</button>
    <button onclick="trocarTela('rotinas', this)" class="nav-item">üìÖ</button>
</nav>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyAh3J8bp7xvNGct8k4TfAoCcIpVRoWjBYI",
    authDomain: "rotinaeduardo.firebaseapp.com",
    projectId: "rotinaeduardo",
    storageBucket: "rotinaeduardo.firebasestorage.app",
    messagingSenderId: "210945268922",
    appId: "1:210945268922:web:ce9e585872090b378d7683"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let userId = null;

onAuthStateChanged(auth, (user) => {
    if (user) {
        userId = user.uid;
        carregarAtividades();
        carregarRotinas();
    } else {
        alert("Usu√°rio n√£o autenticado");
    }
});

window.salvarAtividade = async function() {
    const texto = document.getElementById("txtAtividade").value;
    if (!texto) return alert("Digite a atividade");

    await addDoc(collection(db, "usuarios", userId, "atividades"), {
        texto: texto,
        criadoEm: new Date()
    });

    document.getElementById("txtAtividade").value = "";
}

function carregarAtividades() {
    const q = query(collection(db, "usuarios", userId, "atividades"), orderBy("criadoEm", "desc"));

    onSnapshot(q, (snapshot) => {
        const lista = document.getElementById("listaAtividades");
        lista.innerHTML = "";

        snapshot.forEach((doc) => {
            const li = document.createElement("li");
            li.innerHTML = doc.data().texto + " ‚ùå";
            li.onclick = () => deleteDoc(doc.ref);
            lista.appendChild(li);
        });
    });
}

window.salvarRotina = async function() {
    const hora = document.getElementById("horaRotina").value;
    if (!hora) return alert("Escolha um hor√°rio");

    await addDoc(collection(db, "usuarios", userId, "rotinas"), {
        hora: hora,
        criadoEm: new Date()
    });

    document.getElementById("horaRotina").value = "";
}

function carregarRotinas() {
    const q = query(collection(db, "usuarios", userId, "rotinas"), orderBy("hora"));

    onSnapshot(q, (snapshot) => {
        const lista = document.getElementById("listaRotinas");
        lista.innerHTML = "";

        snapshot.forEach((doc) => {
            const div = document.createElement("div");
            div.innerHTML = "‚è∞ " + doc.data().hora + " ‚ùå";
            div.onclick = () => deleteDoc(doc.ref);
            lista.appendChild(div);
        });
    });
}

window.logout = function() {
    signOut(auth).then(() => {
        alert("Logout realizado");
        location.reload();
    });
}

window.trocarTela = function(nome, botao) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('screen-' + nome).classList.add('active');
    botao.classList.add('active');
}

</script>

</body>
</html>
